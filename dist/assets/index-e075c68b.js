var Y=Object.defineProperty;var tt=(i,t,e)=>t in i?Y(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var a=(i,t,e)=>(tt(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();const k=16,m=8;var z=(i=>(i[i.x=64]="x",i[i.y=64]="y",i))(z||{}),B=(i=>(i[i.w=14]="w",i[i.h=16]="h",i))(B||{}),x=(i=>(i[i.w=16]="w",i[i.h=16]="h",i))(x||{});const et=1500,st=1,it=0;var b=(i=>(i.SPACE="Space",i.ARROW_RIGHT="ArrowRight",i.ARROW_LEFT="ArrowLeft",i.SPEED_X="KeyX",i))(b||{});const O=256,j=256;var F=(i=>(i[i.width=64]="width",i[i.height=64]="height",i))(F||{});const D=.001,nt=2e-4,h={TOP:Symbol("top"),BOTTOM:Symbol("bottom"),RIGHT:Symbol("right"),LEFT:Symbol("left")},ot=100,rt="./assets/img/font-coin.png",at=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";class ct{constructor(){a(this,"keyStates");a(this,"keyMap");this.keyStates=new Map,this.keyMap=new Map}addMapping(t,e){this.keyMap.set(t,e)}handleEvent(t){const{code:e}=t;if(!this.keyMap.has(e))return;t.preventDefault();const s=t.type==="keydown"?st:it;this.keyStates.get(e)!==s&&(this.keyStates.set(e,s),this.keyMap.get(e)(s))}listenTo(t){["keydown","keyup"].forEach(s=>{t.addEventListener(s,n=>{this.handleEvent(n)})})}}const H=function(i,t){t?i.jump.start():i.jump.cancel()},N=function(i,t){i.turbo&&i.turbo(t)},W=function(i,t){i.go.dir+=t?1:-1},X=function(i,t){i.go.dir+=t?-1:1},dt=function(i,t){return function(s){const n=Math.floor(s/t)%i.length;return i[n]}},lt=function(i){const t=new ct;return t.addMapping(b.SPACE,e=>{H(i,e)}),t.addMapping(b.SPEED_X,e=>{N(i,e)}),t.addMapping(b.ARROW_RIGHT,e=>{W(i,e)}),t.addMapping(b.ARROW_LEFT,e=>{X(i,e)}),t};class ut{constructor(t=1/60){a(this,"update");a(this,"updateProxy");let e=0,s=0;this.updateProxy=n=>{for(e+=(n-s)/1e3,e>1&&(e=1);e>t;)this.update(t),e-=t;s=n,this.enqueue()}}enqueue(){requestAnimationFrame(this.updateProxy)}start(){this.enqueue()}}class _{constructor(){a(this,"grid");this.grid=[]}forEach(t){this.grid.forEach((e,s)=>{e.forEach((n,o)=>{t(n,s,o)})})}get(t,e){const s=this.grid[t];if(s)return s[e]}set(t,e,s){this.grid[t]||(this.grid[t]=[]),this.grid[t][e]=s}}class y{constructor(t,e){a(this,"x");a(this,"y");this.set(t,e)}set(t,e){this.x=t,this.y=e}}class ht{constructor(){a(this,"pos");a(this,"size");this.pos=new y(0,0),this.size=new y(O,j)}}class ft{constructor(){a(this,"layers");this.layers=[]}draw(t,e){this.layers.forEach(s=>{s(t,e)})}}class pt{constructor(t){a(this,"entities");this.entities=t}check(t){this.entities.forEach(e=>{t!==e&&t.bounds.overlaps(e.bounds)&&(t.collides(e),e.collides(t))})}}class ${constructor(t,e=k){a(this,"matrix");a(this,"tileSize");this.matrix=t,this.tileSize=e}toIndex(t){return Math.floor(t/this.tileSize)}toIndexRange(t,e){const s=Math.ceil(e/this.tileSize)*this.tileSize,n=[];let o=t;do n.push(this.toIndex(o)),o+=this.tileSize;while(o<s);return n}getByIndex(t,e){const s=this.matrix.get(t,e);if(s){const n=t*this.tileSize,o=n+this.tileSize,r=e*this.tileSize,c=r+this.tileSize;return{tile:s,x1:n,x2:o,y1:r,y2:c}}}searchByPosition(t,e){return this.getByIndex(this.toIndex(t),this.toIndex(e))}searchByRange(t,e,s,n){const o=[];return this.toIndexRange(t,e).forEach(r=>{this.toIndexRange(s,n).forEach(c=>{const d=this.getByIndex(r,c);d&&o.push(d)})}),o}}class mt{constructor(t){a(this,"tiles");this.tiles=new $(t)}checkX(t){let e;if(t.vel.x>0)e=t.bounds.right;else if(t.vel.x<0)e=t.bounds.left;else return;this.tiles.searchByRange(e,e,t.bounds.top,t.bounds.bottom).forEach(n=>{n.tile.type==="ground"&&(t.vel.x>0?t.bounds.right>n.x1&&t.obstruct(h.RIGHT,n):t.vel.x<0&&t.bounds.left<n.x2&&t.obstruct(h.LEFT,n))})}checkY(t){let e;if(t.vel.y>0)e=t.bounds.bottom;else if(t.vel.y<0)e=t.bounds.top;else return;this.tiles.searchByRange(t.bounds.left,t.bounds.right,e,e).forEach(n=>{n.tile.type==="ground"&&(t.vel.y>0?t.bounds.bottom>n.y1&&t.obstruct(h.BOTTOM,n):t.vel.y<0&&t.bounds.top<n.y2&&t.obstruct(h.TOP,n))})}}class gt{constructor(){a(this,"gravity");a(this,"comp");a(this,"entities");a(this,"tiles");a(this,"tileCollider");a(this,"entityCollider");a(this,"totalTime");this.gravity=et,this.totalTime=0,this.comp=new ft,this.entities=new Set,this.entityCollider=new pt(this.entities),this.tileCollider=null}setCollisionGrid(t){this.tileCollider=new mt(t)}update(t){this.entities.forEach(e=>{this.tileCollider&&e.update(t,this)}),this.entities.forEach(e=>{this.entityCollider.check(e)}),this.entities.forEach(e=>{e.finalize()}),this.totalTime+=t.deltaTime}}class K{constructor(t,e,s){a(this,"image");a(this,"width");a(this,"height");a(this,"tiles");a(this,"animations");this.image=t,this.width=e,this.height=s,this.tiles=new Map,this.animations=new Map}defineAnim(t,e){this.animations.set(t,e)}define(t,e,s,n,o){const r=[!1,!0].map(c=>{const d=document.createElement("canvas");d.width=n,d.height=o;const l=d.getContext("2d");return c&&(l.scale(-1,1),l.translate(-n,0)),l.drawImage(this.image,e,s,n,o,0,0,n,o),d});this.tiles.set(t,r)}defineTile(t,e,s){this.define(t,e*this.width,s*this.height,this.width,this.height)}draw(t,e,s,n,o=!1){const r=this.tiles.get(t);r&&e.drawImage(r[Number(o)],s,n)}drawAnim(t,e,s,n,o){const r=this.animations.get(t);this.drawTile(r(o),e,s,n)}drawTile(t,e,s,n){this.draw(t,e,s*this.width,n*this.height)}}class I{constructor(){a(this,"buffers");this.buffers=new Map}addAudio(t,e){this.buffers.set(t,e)}playAudio(t,e){const s=e.createBufferSource();s.connect(e.destination),s.buffer=this.buffers.get(t)||null,s.start(0)}}class yt{constructor(t,e,s){a(this,"pos");a(this,"size");a(this,"offset");this.pos=t,this.size=e,this.offset=s}overlaps(t){return this.bottom>t.top&&this.top<t.bottom&&this.left<t.right&&this.right>t.left}get bottom(){return this.pos.y+this.size.y+this.offset.y}set bottom(t){this.pos.y=t-(this.size.y+this.offset.y)}get top(){return this.pos.y+this.offset.y}set top(t){this.pos.y=t-this.offset.y}get left(){return this.pos.x+this.offset.x}set left(t){this.pos.x=t-this.offset.x}get right(){return this.pos.x+this.size.x+this.offset.x}set right(t){this.pos.x=t-(this.size.x+this.offset.x)}}class f{constructor(t){a(this,"NAME");a(this,"tasks");a(this,"sounds");this.NAME=t,this.sounds=new Set,this.tasks=[]}finalize(){this.tasks.forEach(t=>t()),this.tasks.length=0}queue(t){this.tasks.push(t)}collides(t,e){}obstruct(t,e,s=void 0){}playSound(t,e){this.sounds.forEach(s=>{t.playAudio(s,e)}),this.sounds.clear()}update(t,e,s=void 0){}}class L{constructor(){a(this,"pos");a(this,"vel");a(this,"size");a(this,"offset");a(this,"bounds");a(this,"traits");a(this,"lifetime");a(this,"canCollide");a(this,"audio");a(this,"turbo");this.canCollide=!0,this.pos=new y(0,0),this.vel=new y(0,0),this.size=new y(0,0),this.offset=new y(0,0),this.bounds=new yt(this.pos,this.size,this.offset),this.lifetime=0,this.traits=[],this.audio=new I}addTrait(t){this.traits.push(t),this[t.NAME]=t}collides(t){this.traits.forEach(e=>{e.collides(this,t)})}obstruct(t,e=void 0){this.traits.forEach(s=>{s.obstruct(this,t,e)})}update(t,e){this.traits.forEach(s=>{s.update(this,t,e),s.playSound(this.audio,t.audioContext)}),this.lifetime+=t.deltaTime}draw(t){}finalize(){this.traits.forEach(t=>{t.finalize()})}}class P extends f{constructor(){super("killable");a(this,"dead");a(this,"deadTime");a(this,"removeAfter");this.dead=!1,this.deadTime=0,this.removeAfter=2}kill(){this.queue(()=>this.dead=!0)}revive(){this.dead=!1,this.deadTime=0}update(e,{deltaTime:s},n){this.dead&&(this.deadTime+=s,!(this.deadTime<=this.removeAfter)&&this.queue(()=>{n.entities.delete(e)}))}}class J extends f{constructor(){super("pendulumMove");a(this,"speed");a(this,"enabled");this.enabled=!0,this.speed=-30}obstruct(e,s){(s===h.LEFT||s===h.RIGHT)&&(this.speed=-this.speed)}update(e){this.enabled&&(e.vel.x=this.speed)}}class G extends f{constructor(){super("physics")}update(t,{deltaTime:e},s){t.pos.x+=t.vel.x*e,s.tileCollider.checkX(t),t.pos.y+=t.vel.y*e,s.tileCollider.checkY(t),t.vel.y+=s.gravity*e}}class R extends f{constructor(){super("solid");a(this,"obstructs");this.obstructs=!0}obstruct(e,s,n){this.obstructs&&(s===h.BOTTOM?(e.bounds.bottom=n.y1,e.vel.y=0):s===h.TOP?(e.bounds.top=n.y2,e.vel.y=0):s===h.LEFT?(e.bounds.left=n.x2,e.vel.x=0):s===h.RIGHT&&(e.bounds.right=n.x1,e.vel.x=0))}}const wt=async function(i){return M("goomba").then(vt)};let bt=class extends f{constructor(){super("behavior")}collides(t,e){var s;if(!t.killable.dead&&e.stomper){if(e.vel.y<=t.vel.y){(s=e.killable)==null||s.kill();return}t.killable.kill(),t.pendulumMove.speed=0}}};const vt=function(i){const t=i.animations.get("walk"),e=function(n){return n.killable.dead?"flat":t(n.lifetime)},s=function(n){i.draw(e(this),n,0,0)};return function(){const o=new L;return o.size.set(x.w,x.h),o.addTrait(new G),o.addTrait(new R),o.addTrait(new J),o.addTrait(new bt),o.addTrait(new P),o.draw=s,o}},xt=async function(i){return M("koopa").then(St)},T=Symbol("walking"),v=Symbol("hiding"),S=Symbol("panic");class Tt extends f{constructor(){super("behavior");a(this,"state");a(this,"hideTime");a(this,"hideDuration");a(this,"panicSpeed");a(this,"walkSpeed");this.hideTime=0,this.hideDuration=5,this.panicSpeed=300,this.walkSpeed=null,this.state=T}collides(e,s){if(!e.killable.dead&&s.stomper){if(s.vel.y<=e.vel.y){this.handleNudge(e,s);return}this.handleStomp(e,s)}}handleNudge(e,s){var n,o;if(this.state===T)(n=s.killable)==null||n.kill();else if(this.state===v)this.panic(e,s);else if(this.state===S){const r=Math.sign(e.vel.x),c=Math.sign(e.pos.x-s.pos.x);r!==0&&r!==c&&((o=s.killable)==null||o.kill())}}handleStomp(e,s){this.state===T?this.hide(e):this.state===v?(e.killable.kill(),e.vel.set(100,-200),e.solid.obstructs=!1):this.state===S&&this.hide(e)}hide(e){e.vel.x=0,e.pendulumMove.enabled=!1,this.walkSpeed===null&&(this.walkSpeed=e.pendulumMove.speed),this.hideTime=0,this.state=v}unhide(e){e.pendulumMove.enabled=!0,this.walkSpeed&&(e.pendulumMove.speed=this.walkSpeed),this.state=T}panic(e,s){e.pendulumMove.enabled=!0,e.pendulumMove.speed=this.panicSpeed*Math.sign(s.vel.x),this.state=S}update(e,{deltaTime:s}){this.state===v&&(this.hideTime+=s,!(this.hideTime<=this.hideDuration)&&this.unhide(e))}}const St=function(i){const t=i.animations.get("walk"),e=i.animations.get("wake"),s=function(o){const r=o.behavior;return r.state===v?r.hideTime>3?e(r.hideTime):"hiding":r.state===S?"hiding":t(o.lifetime)},n=function(o){i.draw(s(this),o,0,0,this.vel.x<0)};return function(){const r=new L;return r.size.set(x.w,x.h),r.offset.y=8,r.addTrait(new G),r.addTrait(new R),r.addTrait(new J),r.addTrait(new Tt),r.addTrait(new P),r.draw=n,r}};class kt extends f{constructor(){super("go");a(this,"dir");a(this,"acceleration");a(this,"deceleration");a(this,"dragFactor");a(this,"distance");a(this,"heading");this.dir=0,this.acceleration=400,this.deceleration=300,this.dragFactor=D,this.distance=0,this.heading=1}update(e,{deltaTime:s}){const n=Math.abs(e.vel.x);if(this.dir!==0)e.vel.x+=this.acceleration*s*this.dir,e.jump?e.jump.falling===!1&&(this.heading=this.dir):this.heading=this.dir;else if(e.vel.x!==0){const r=Math.min(n,this.deceleration*s);e.vel.x+=e.vel.x>0?-r:r}else this.distance=0;const o=this.dragFactor*e.vel.x*n;e.vel.x-=o,this.distance+=n*s}}class Et extends f{constructor(){super("jump");a(this,"duration");a(this,"velocity");a(this,"engageTime");a(this,"ready");a(this,"requestTime");a(this,"gracePeriod");a(this,"speedBoost");this.ready=0,this.duration=.3,this.engageTime=0,this.requestTime=0,this.gracePeriod=.1,this.speedBoost=.3,this.velocity=200}get falling(){return this.ready<0}start(){this.requestTime=this.gracePeriod}cancel(){this.engageTime=0,this.requestTime=0}obstruct(e,s){s===h.BOTTOM?this.ready=1:s===h.TOP&&this.cancel()}update(e,{deltaTime:s}){this.requestTime>0&&(this.ready>0&&(this.sounds.add("jump"),this.engageTime=this.duration,this.requestTime=0),this.requestTime-=s),this.engageTime>0&&(e.vel.y=-(this.velocity+Math.abs(e.vel.x)*this.speedBoost),this.engageTime-=s),this.ready--}}class Lt extends f{constructor(){super("stomper");a(this,"bounceSpeed");a(this,"onStomp");this.bounceSpeed=400,this.onStomp=function(){}}bounce(e,s){e.bounds.bottom=s.bounds.top,e.vel.y=-this.bounceSpeed}collides(e,s){!s.killable||s.killable.dead||e.vel.y>s.vel.y&&(this.bounce(e,s),this.sounds.add("stomp"),this.onStomp())}}async function Mt(i,t){const e=At(t),s=await q(`/data/sounds/${i}.json`),n=new I,o=s.fx,r=[];return Object.keys(o).forEach(d=>{const{url:l}=o[d],u=e(`/assets/audio/${l}`).then(p=>{n.addAudio(d,p)});r.push(u)}),Promise.all(r).then(()=>n)}function At(i){return async function(e){return fetch(e).then(s=>s.arrayBuffer()).then(s=>i.decodeAudioData(s))}}const Ct=async function(i){const t=await M("mario"),e=await Mt("mario",i);return zt(t,e)},zt=function(i,t){const e=i.animations.get("run");function s(r){return r.jump.falling?"jump":r.go.distance>0?r.vel.x>0&&r.go.dir<0||r.vel.x<0&&r.go.dir>0?"break":e(r.go.distance):"idle"}function n(r){this.go.dragFactor=r?nt:D}function o(r){i.draw(s(this),r,0,0,this.go.heading<0)}return function(){const c=new L;return c.audio=t,c.size.set(B.w,B.h),c.addTrait(new G),c.addTrait(new R),c.addTrait(new kt),c.addTrait(new Et),c.addTrait(new Lt),c.addTrait(new P),c.killable.removeAfter=0,c.turbo=n,c.draw=o,c.turbo(!1),c}},V=function(i){return new Promise(t=>{const e=new Image;e.addEventListener("load",()=>{t(e)}),e.src=i})},q=async function(i){return fetch(i).then(t=>t.json())},M=async function(i){var n,o,r;const t=await q(`/data/sprites/${i}.json`),e=await V(t.imageURL),s=new K(e,t.tileW||k,t.tileH||k);return(n=t.tiles)==null||n.forEach(c=>{s.defineTile(c.name,c.index[0],c.index[1])}),(o=t.frames)==null||o.forEach(c=>{s.define(c.name,...c.rect)}),(r=t.animations)==null||r.forEach(c=>{const d=dt(c.frames,c.frameLen);s.defineAnim(c.name,d)}),s},Bt=async function(i){const t={mario:function(){throw new Error("Function not implemented.")},goomba:function(){throw new Error("Function not implemented.")},koopa:function(){throw new Error("Function not implemented.")}},e=function(s){return n=>t[s]=n};return Promise.all([Ct(i).then(e("mario")),wt().then(e("goomba")),xt().then(e("koopa"))]).then(()=>t)},Ft=function(i,t,e){const s=new $(t),n=document.createElement("canvas");n.width=O+16,n.height=j;const o=n.getContext("2d");function r(c,d){o.clearRect(0,0,n.width,n.height);for(let l=c;l<=d;++l){const u=t.grid[l];u&&u.forEach((p,g)=>{const w=p;e.animations.has(w.name)?e.drawAnim(w.name,o,l-c,g,i.totalTime):e.drawTile(w.name,o,l-c,g)})}}return function(d,l){const u=s.toIndex(l.size.x),p=s.toIndex(l.pos.x),g=p+u;r(p,g),d.drawImage(n,-l.pos.x%k,-l.pos.y)}},Pt=function(i,t=F.width,e=F.width){const s=document.createElement("canvas");s.width=t,s.height=e;const n=s.getContext("2d");return function(r,c){i.forEach(d=>{n.clearRect(0,0,t,e),d.draw(n),r.drawImage(s,d.pos.x-c.pos.x,d.pos.y-c.pos.y)})}},C=function*(i,t,e,s){const n=i+t,o=e+s;for(let r=i;r<n;++r)for(let c=e;c<o;++c)yield{x:r,y:c}},Gt=function(i){if(i.length===4){const[t,e,s,n]=i;return C(t,e,s,n)}else if(i.length===3){const[t,e,s]=i;return C(t,e,s,1)}else{const[t,e]=i;return C(t,1,e,1)}},Rt=function*(i){for(const t of i)yield*Gt(t)},U=function*(i,t){function*e(s,n,o){for(const r of s)for(const{x:c,y:d}of Rt(r.ranges)){const l=c+n,u=d+o;if(r.pattern){const p=t[r.pattern];yield*e(p.tiles,l,u);continue}yield{tile:r,x:l,y:u}}}yield*e(i,0,0)},qt=function(i,t){const e=new _;for(const{tile:s,x:n,y:o}of U(i,t))e.set(n,o,{type:s.type});return e},Ot=function(i,t){const e=new _;for(const{tile:s,x:n,y:o}of U(i,t))e.set(n,o,{name:s.name});return e},jt=function(i,t){const e=i.layers.reduce((n,o)=>n.concat(o.tiles),[]),s=qt(e,i.patterns);t.setCollisionGrid(s)},Dt=function(i,t,e){i.layers.forEach(s=>{const n=Ot(s.tiles,i.patterns),o=Ft(t,n,e);t.comp.layers.push(o)})},Ht=function(i,t,e){i.entities.forEach(({name:n,pos:[o,r]})=>{const c=e[n],d=c();d.pos.set(o,r),t.entities.add(d)});const s=Pt(t.entities);t.comp.layers.push(s)},Nt=async function(i){return async function(e){const s=await q(`/data/levels/${e}.json`),n=await M(s.spritesheet),o=new gt;return jt(s,o),Dt(s,o,n),Ht(s,o,i),o}},Wt=function(i){const t=document.querySelector("[data-action='left']"),e=document.querySelector("[data-action='right']"),s=document.querySelector("[data-action='jump']"),n=document.querySelector("[data-action='speed']"),o={left:{elem:t,fn:function(c){X(i,c)},handle:!1},right:{elem:e,fn:function(c){W(i,c)},handle:!1},jump:{elem:s,fn:function(c){H(i,c)},handle:!1},speed:{elem:n,fn:function(c){N(i,c)},handle:!1}};["pointerdown","pointerup","pointercancel","pointerout","pointerleave"].forEach(c=>{for(const d in o){const l=o[d];l.elem.addEventListener(c,function(){if(c==="pointerdown")return l.handle=!0,l.fn(!0);l.handle&&(l.fn(!1),l.handle=!1)})}})};class Xt extends f{constructor(){super("playerController");a(this,"player");a(this,"checkpoint");a(this,"time");a(this,"score");this.checkpoint=new y(0,0),this.player=null,this.time=300,this.score=0}setPlayer(e){this.player=e,this.player.stomper&&(this.player.stomper.onStomp=()=>{this.score+=ot})}update(e,{deltaTime:s},n){var o;if(this.player){if(!n.entities.has(this.player)){(o=this.player.killable)==null||o.revive(),this.player.pos.set(this.checkpoint.x,this.checkpoint.y),n.entities.add(this.player);return}this.time-=s*2}}}const _t=function(i){return function(e,s){e.strokeStyle="red",i.forEach(n=>{e.beginPath(),e.rect(n.bounds.left-s.pos.x,n.bounds.top-s.pos.y,n.size.x,n.size.y),e.stroke()})}},$t=function(i){const t=[],e=i.tiles,s=e.tileSize,n=e.getByIndex;return e.getByIndex=function(r,c){return t.push({x:r,y:c}),n.call(e,r,c)},function(r,c){r.strokeStyle="blue",t.forEach(({x:d,y:l})=>{r.beginPath(),r.rect(d*s-c.pos.x,l*s-c.pos.y,s,s),r.stroke()}),t.length=0}};function Kt(i){if(!i.tileCollider)return;const t=$t(i.tileCollider),e=_t(i.entities);return function(n,o){t(n,o),e(n,o)}}function It(i){return[...i].includes(i)}class Jt{constructor(t,e=m){a(this,"sprites");a(this,"size",m);this.sprites=t,this.size=e}print(t,e,s,n){[...t].forEach((o,r)=>{It(o)&&this.sprites.draw(o,e,s+r*this.size,n)})}}const Vt=async function(){return V(rt).then(i=>{const t=new K(i,m,m),e=i.width;for(const[s,n]of[...at].entries()){const o=s*m%e,r=Math.floor(s*m/e)*m;t.define(n,o,r,m,m)}return new Jt(t)})},Ut=function(i,t){const e=i.size,s=i.size*2,n=16;return function(r){const{time:c,score:d}=t.playerController;i.print("MARIO",r,16,e),i.print(d.toString().padStart(6,"0"),r,16,s),i.print(`@x${n.toString().padStart(2,"0")}`,r,96,s),i.print("WORLD",r,152,e),i.print("1-1",r,160,s),i.print("TIME",r,208,e),i.print(c.toFixed().toString().padStart(3,"0"),r,216,s)}},Qt=function(i){const t=new L,e=new Xt;return e.checkpoint.set(z.x,z.y),e.setPlayer(i),t.addTrait(e),t},Zt=async function(i){const t=i.getContext("2d"),e=new AudioContext,[s,n]=await Promise.all([Bt(e),Vt()]),r=await(await Nt(s))("1-1"),c=new ht,d=s.mario(),l=Qt(d);r.entities.add(l);const u=Kt(r);u&&r.comp.layers.push(u),r.comp.layers.push(Ut(n,l)),lt(d).listenTo(window),Wt(d);const g={audioContext:e,deltaTime:0},w=new ut;w.update=function(Z){g.deltaTime=Z,r.update(g),c.pos.x=Math.max(0,d.pos.x-100),r.comp.draw(t,c)},w.start()},E=document.getElementById("screen"),A=E.getContext("2d");A.font="30px Comic Sans MS";A.fillStyle="white";A.textAlign="center";A.fillText("Hit Click To Play",E.width/2,E.height/2);const Q=function(){window.removeEventListener("click",Q),Zt(E)};window.addEventListener("click",Q);
