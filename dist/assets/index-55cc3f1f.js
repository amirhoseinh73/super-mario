var p=Object.defineProperty;var w=(s,e,t)=>e in s?p(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var a=(s,e,t)=>(w(s,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();const g=function(s){return new Promise(e=>{const t=new Image;t.addEventListener("load",()=>{e(t)}),t.src=s})},L=async function(s){return fetch(`/@levels/${s}.json`).then(e=>e.json())};class m{constructor(e,t,n){a(this,"image");a(this,"width");a(this,"height");a(this,"tiles");this.image=e,this.width=t,this.height=n,this.tiles=new Map}define(e,t,n,r,o){var c;const i=document.createElement("canvas");i.width=r,i.height=o,(c=i.getContext("2d"))==null||c.drawImage(this.image,t,n,r,o,0,0,r,o),this.tiles.set(e,i)}defineTile(e,t,n){this.define(e,t*this.width,n*this.height,this.width,this.height)}draw(e,t,n,r){const o=this.tiles.get(e);t.drawImage(o,n,r)}drawTile(e,t,n,r){this.draw(e,t,n*this.width,r*this.height)}}const E="/assets/tiles-1dcaf0e0.png",I="/assets/characters-802da64a.gif",y={tiles:E,characters:I},u=16,f={sky:{X:3,Y:23},ground:{X:0,Y:0},mario:{X:276,Y:44}},d={X:64,Y:64},X=async function(){return g(y.characters).then(s=>{const e=new m(s,u,u),t=f.mario;return e.define("mario",t.X,t.Y,16,16),e})},Y=async function(){return g(y.tiles).then(s=>{const e=new m(s,u,u),t=f.ground;e.defineTile("ground",t.X,t.Y);const n=f.sky;return e.defineTile("sky",n.X,n.Y),e})};class S{constructor(){a(this,"layers");this.layers=[]}draw(e){this.layers.forEach(t=>{t(e)})}}const b=function(s,e,t){s.ranges.forEach(([n,r,o,i])=>{for(let c=n;c<r;c++)for(let l=o;l<i;l++)t.drawTile(s.tile,e,c,l)})},v=function(s,e){const t=document.createElement("canvas");return t.width=640,t.height=256,s.forEach(r=>{const o=t.getContext("2d");b(r,o,e)}),function(r){r.drawImage(t,0,0)}},P=document.getElementById("screen"),h=P.getContext("2d"),T=function(s,e){return function(n){s.draw("mario",n,e.X,e.Y)}};Promise.all([X(),Y(),L("1-1")]).then(([s,e,t])=>{const n=new S,r=v(t.backgrounds,e);n.layers.push(r);const o=T(s,d);n.layers.push(o);const i=function(){n.draw(h),s.draw("mario",h,d.X,d.Y),d.X+=2,d.Y+=2,requestAnimationFrame(i)};i()});
